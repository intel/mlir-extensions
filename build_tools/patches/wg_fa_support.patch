From 1556527c6b9b4a99438172118f4202a77731dcbc Mon Sep 17 00:00:00 2001
From: Garra1980 <igor.zamyatin@intel.com>
Date: Tue, 20 Jan 2026 15:53:45 +0100
Subject: [PATCH] wg_fa

---
 .../XeGPU/Transforms/XeGPUBlocking.cpp        |  3 +-
 .../XeGPU/Transforms/XeGPUPropagateLayout.cpp | 59 +++++++++++++++++++
 .../Transforms/XeGPUWgToSgDistribute.cpp      | 12 ++--
 3 files changed, 67 insertions(+), 7 deletions(-)

diff --git a/mlir/lib/Dialect/XeGPU/Transforms/XeGPUBlocking.cpp b/mlir/lib/Dialect/XeGPU/Transforms/XeGPUBlocking.cpp
index 931834ba16d9..f59464a55d60 100644
--- a/mlir/lib/Dialect/XeGPU/Transforms/XeGPUBlocking.cpp
+++ b/mlir/lib/Dialect/XeGPU/Transforms/XeGPUBlocking.cpp
@@ -228,7 +228,8 @@ XeGPUBlockingPass::getTileShape(Operation *op) const {
   if (isa<vector::MultiDimReductionOp>(op))
     return getTileShape(op->getOpOperand(0));
 
-  if (isa<vector::TransposeOp, vector::BroadcastOp, vector::StepOp,
+  if (isa<vector::TransposeOp, vector::BroadcastOp,
+          vector::ShapeCastOp, vector::StepOp,
           vector::ConstantMaskOp, vector::CreateMaskOp>(op))
     return getTileShape(op->getOpResult(0));
 
diff --git a/mlir/lib/Dialect/XeGPU/Transforms/XeGPUWgToSgDistribute.cpp b/mlir/lib/Dialect/XeGPU/Transforms/XeGPUWgToSgDistribute.cpp
index 8328c2797be4..679f11bd1d43 100644
--- a/mlir/lib/Dialect/XeGPU/Transforms/XeGPUWgToSgDistribute.cpp
+++ b/mlir/lib/Dialect/XeGPU/Transforms/XeGPUWgToSgDistribute.cpp
@@ -1582,13 +1582,13 @@ struct WgToSgVectorTransposeOp
     SmallVector<int64_t> sourceSgLayout =
         sourceLayout.getEffectiveSgLayoutAsInt();
     SmallVector<int64_t> resultSgLayout = layout.getEffectiveSgLayoutAsInt();
-    DenseI32ArrayAttr sourceOrder = sourceLayout.getOrder();
-    DenseI32ArrayAttr resultOrder = layout.getOrder();
+    // DenseI32ArrayAttr sourceOrder = sourceLayout.getOrder();
+    // DenseI32ArrayAttr resultOrder = layout.getOrder();
 
-    if (!sourceOrder || !resultOrder) {
-      return rewriter.notifyMatchFailure(
-          op, "Both source and result must have order attributes");
-    }
+    // if (!sourceOrder || !resultOrder) {
+    //   return rewriter.notifyMatchFailure(
+    //       op, "Both source and result must have order attributes");
+    // }
 
     ArrayRef<int64_t> permutation = op.getPermutation();
     size_t permutationSize = permutation.size();
-- 
2.34.1

